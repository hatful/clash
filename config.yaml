# --------------------------------ClashX Kindly Config-----------------------------------------------
# @GitHub https://github.com/LittlePonyX/ClashXKindly-config
# @Version 1.0.1
# @rules https://github.com/Loyalsoldier/clash-rules
# @rules https://github.com/blackmatrix7/ios_rule_script
# --------------------------------ClashX Kindly Config-----------------------------------------------

mixed-port: 1086
mode: rule
allow-lan: true
log-level: info

external-ui: yacd-meta
external-controller: 0.0.0.0:9090
# secret: "ytYJ42g92tjU@!%z"

# DNS æœåŠ¡å™¨é…ç½® æŒ‰éœ€å¯ç”¨ è‹¥ä¸é…ç½®ç¨‹åºå†…ç½®çš„ DNS æœåŠ¡ä¼šè¢«å…³é—­
dns:
  enable: true # æ— ç‰¹æ®Šéœ€æ±‚ä¸å»ºè®®å¯ç”¨
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  # è¯¦ç»†å‚è§ https://github.com/Hackl0us/SS-Rule-Snippet/blob/master/LAZY_RULES/Clash_Premium.yaml
  fake-ip-filter:
    - "*.lan"
    - time.*.com
    - time.*.gov
    - time.*.edu.cn
    - time.*.apple.com
    - ntp.*.com
    - "*.ntp.org.cn"
    - "+.pool.ntp.org"
    - "*.localhost"
    - "*.bitiiot.com"
    - "*.mageia.site"
  # æ‰€æœ‰ DNS è¯·æ±‚å°†ä¼šç›´æ¥å‘é€åˆ°æœåŠ¡å™¨ ä¸ç»è¿‡ä»»ä½•ä»£ç†
  nameserver: [223.5.5.5, 119.29.29.29]
  # å½“ fallback å‚æ•°è¢«é…ç½®æ—¶ DNS è¯·æ±‚å°†åŒæ—¶å‘é€è‡³ä¸Šæ–¹ nameserver åˆ—è¡¨å’Œä¸‹æ–¹ fallback åˆ—è¡¨ä¸­é…ç½®çš„æ‰€æœ‰ DNS æœåŠ¡å™¨
  # å½“è§£æå¾—åˆ°çš„ IP åœ°å€çš„åœ°ç†ä½ç½®ä¸æ˜¯ CN æ—¶ clash å°†ä¼šé€‰ç”¨ fallback ä¸­ DNS æœåŠ¡å™¨çš„è§£æç»“æœ
  fallback:
    [
      "tls://1.0.0.1",
      "tls://8.8.4.4",
      "https://cloudflare-dns.com/dns-query",
      "https://dns.google/dns-query",
    ]
  # è¿™äº›å‚æ•°æ˜¯ä¸ºäº†å¯¹æŠ—DNSæŠ•æ¯’ å»ºè®®åœ¨ DNS æŠ•æ¯’ä¸¥é‡æ—¶å¯ç”¨
  fallback-filter:
    { geoip: true, geoip-code: CN, ipcidr: [240.0.0.0/4, 0.0.0.0/32] }

tun:
  enable: true
  stack: system # or gvisor
  dns-hijack:
    - 8.8.8.8:53
    - tcp://8.8.8.8:53
    - any:53
    - tcp://any:53
      # auto-route: true # auto set global route
  auto-detect-interface: true # conflict with interface-name

# proxy-providerså‚æ•°é”šç‚¹ æ–¹ä¾¿å¤šè®¢é˜…æºå¤ç”¨
pvd-info: &pvd-info # æ›´æ–°è®¢é˜…å‘¨æœŸ 3å¤©
  interval: 259200
  # èŠ‚ç‚¹çŠ¶æ€æ£€æŸ¥
  health-check:
    enable: true
    url: http://www.gstatic.com/generate_204
    interval: 600

# clash é“¾æ¥æ— é¡»è½¬æ¢ èŠ‚ç‚¹è®¢é˜…è½¬æ¢ https://sub.xeton.dev/sub?target=clash&url=è®¢é˜…é“¾æ¥å¤šä¸ªç”¨|åˆ†å‰²&list=true&udp=false
# å¯é€‰è‡ªå»ºæˆ–å…¶ä»–è®¢é˜…è½¬æ¢å·¥å…· æ¨èé€‰æ‹©è¾“å‡ºä¸º NodeList ä¹Ÿå¯å¤„ç†èŠ‚ç‚¹è¿‡æ»¤
proxy-providers:
  Subscribe:
    # ä»£ç†æä¾›å•†ç±»å‹ http|file
    type: http
    # å¼•ç”¨å‚æ•°é”šç‚¹
    <<: *pvd-info
    # æ’é™¤å…³é”®å­—ä½¿ç”¨excludeå‚æ•°(UrlCodeç¼–ç )ä¾‹å¦‚è¦æ’é™¤"æµ·å¤–|åˆ°æœŸ"åœ¨é“¾æ¥åè¿½åŠ  &exclude=%E6%B5%B7%E5%A4%96%7C%E5%88%B0%E6%9C%9F
    # exclude=å¥—å¨ƒ|V1|V2
    url: https://sub.xeton.dev/sub?target=clash&url=https%3A%2F%2Frss2024.biteb-sub.com%2Flink%2FHsh1Uw6OPBU8qM5R%3Fclash%3D1&list=true&udp=false&exclude=%E5%A5%97%E5%A8%83%7CV1%7CV2
    # è®¢é˜…å†…å®¹ä¿å­˜è·¯å¾„
    path: ./Providers/Proxies/Subscribe.yaml
    # filter: 'HK|TW|US' # è¿‡æ»¤èŠ‚ç‚¹ Golang regexä¸æ”¯æŒå¤æ‚è¡¨è¾¾å¼ å»ºè®®ç”¨è®¢é˜…è½¬æ¢å·¥å…·è¿‡æ»¤
  # ======== å¼•ç”¨å½“å‰å·²æœ‰clashé…ç½®æ–‡ä»¶ç¤ºä¾‹ ========
  # MyConfig:
  #   type: file
  #   path: MyConfig.yaml # å½“å‰å·²æœ‰é…ç½®æ–‡ä»¶path
  #   health-check:
  #     enable: true
  #     interval: 36000
  #     url: http://www.gstatic.com/generate_204
  #   filter: 'HK|JP|VN|SG'

  # å®šä¹‰èŠ‚ç‚¹è¿‡æ»¤å‚æ•°é”šç‚¹
  filter-info: &filter-info
    type: file
    path: ./Providers/Proxies/Subscribe.yaml

  # ä»£ç†ç»„ä¸­ä¸æ”¯æŒ filter åœ¨è¿™å¤„ç†
  HK-Node: { <<: *filter-info, filter: "æ¸¯|HK|(?i)Hong" }
  TW-Node: { <<: *filter-info, filter: "å°|æ¹¾|TW|(?i)Taiwan" }
  JP-Node: { <<: *filter-info, filter: "æ—¥|ä¸œäº¬|JP|(?i)Japan" }
  SG-Node: { <<: *filter-info, filter: "æ–°|å¡|ç…|SG|(?i)Singapore" }
  US-Node: { <<: *filter-info, filter: "ç¾|US|(?i)States|American" }

# ä½¿ç”¨proxy-providersä¸­çš„èŠ‚ç‚¹ å®šä¹‰é”šç‚¹
all-proxy: &all-proxy
  type: select
  use:
    - Subscribe # å¼•ç”¨è®¢é˜…æ–‡ä»¶
    # - MyConfig # å¼•ç”¨å·²æœ‰é…ç½®æ–‡ä»¶

# å…¶ä»–ä»£ç† è‡ªå»ºç­‰å†™åœ¨è¿™é‡Œ
proxies:
  - {
      name: "CFWarp-A",
      type: wireguard,
      server: 188.114.98.11,
      port: 934,
      ip: 172.16.0.2,
      private-key: SHVqHEGI7k2+OQ/oWMmWY2EQObbRQjRBdDPimh0h1WY=,
      public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=,
      remote-dns-resolve: false,
      udp: true,
    }
  - {
      name: "CFWarp-B",
      type: wireguard,
      server: 162.159.195.113,
      port: 934,
      ip: 172.16.0.2,
      private-key: SHVqHEGI7k2+OQ/oWMmWY2EQObbRQjRBdDPimh0h1WY=,
      public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=,
      remote-dns-resolve: false,
      udp: true,
    }
  - {
      name: "CFWarp-C",
      type: wireguard,
      server: 188.114.98.11,
      port: 1074,
      ip: 172.16.0.2,
      private-key: SHVqHEGI7k2+OQ/oWMmWY2EQObbRQjRBdDPimh0h1WY=,
      public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=,
      remote-dns-resolve: false,
      udp: true,
    }
  - {
      name: "CFWarp-D",
      type: wireguard,
      server: 162.159.195.113,
      port: 1074,
      ip: 172.16.0.2,
      private-key: SHVqHEGI7k2+OQ/oWMmWY2EQObbRQjRBdDPimh0h1WY=,
      public-key: bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=,
      remote-dns-resolve: false,
      udp: true,
    }
# å®šä¹‰è‡ªå»ºä»£ç†é”šç‚¹
local-proxy: &local-proxy
  - CFWarp-A
  - CFWarp-B
  - CFWarp-C
  - CFWarp-D

# å®šä¹‰è‡ªåŠ¨æµ‹é€ŸèŠ‚ç‚¹
auto: &auto-select
  type: url-test
  lazy: true
  url: http://www.gstatic.com/generate_204
  # èŠ‚ç‚¹æ£€æµ‹ é—´éš”10åˆ†é’Ÿ
  interval: 600
  use:
    - Subscribe
    # - MyConfig # å¼•ç”¨å·²æœ‰é…ç½®æ–‡ä»¶

# å®šä¹‰åˆ†æµå‚æ•°é”šç‚¹
group-proxy: &group-proxy
  type: select
  proxies: [è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯èŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹, æ—¥æœ¬èŠ‚ç‚¹, ç‹®åŸèŠ‚ç‚¹, ç¾å›½èŠ‚ç‚¹, DIRECT]

# å®šä¹‰ä»£ç†åˆ†ç»„ ä¸é”šç‚¹åˆå¹¶
proxy-groups:
  - name: è‡ªåŠ¨é€‰æ‹©
    <<: *auto-select
    proxies: [CFWarp-A, CFWarp-B, CFWarp-C, CFWarp-D]

  - name: å›½å¤–åª’ä½“
    type: select
    <<: *group-proxy
    proxies: [è‡ªåŠ¨é€‰æ‹©, DIRECT]

  - name: å“”å“©å“”å“©
    type: select
    proxies: [DIRECT, é¦™æ¸¯èŠ‚ç‚¹, å°æ¹¾èŠ‚ç‚¹]

  - name: OpenAi
    type: select
    proxies: [ç¾å›½èŠ‚ç‚¹]

  - name: è‡ªå®šèŠ‚ç‚¹
    type: select
    proxies: *local-proxy

  - name: è‹¹æœæœåŠ¡
    <<: *group-proxy

  - name: æ¼ç½‘ä¹‹é±¼
    <<: *group-proxy

  # - name: ğŸ† AdBlock # å¹¿å‘Šè¿‡æ»¤åˆ†ç»„ å·²ç”¨å…¶ä»–è¿‡æ»¤å·¥å…·ä¸å»ºè®®Clashä¸­å†å¯ç”¨
  #   type: select
  #   proxies: [REJECT, DIRECT]

  # èŠ‚ç‚¹æŒ‰åœ°åŒºåˆ†ç»„ å½“å‰æ‰‹åŠ¨é€‰æ‹©èŠ‚ç‚¹ å¯å‚è€ƒauto-selecté”šç‚¹æ”¹ä¸ºè‡ªåŠ¨é€‰æ‹©
  - name: é¦™æ¸¯èŠ‚ç‚¹
    type: select
    use:
      - HK-Node

  - name: å°æ¹¾èŠ‚ç‚¹
    type: select
    use:
      - TW-Node

  - name: æ—¥æœ¬èŠ‚ç‚¹
    type: select
    use:
      - JP-Node

  - name: ç‹®åŸèŠ‚ç‚¹
    type: select
    use:
      - SG-Node

  - name: ç¾å›½èŠ‚ç‚¹
    type: select
    use:
      - US-Node

# å®šä¹‰è§„åˆ™é›†å‚æ•°é”šç‚¹ interval 3 å¤©æ›´æ–°ä¸€æ¬¡è¶³å¤Ÿ Meta æ ¸å¿ƒä¸éœ€è¦ type å’Œ path å‚æ•°
rule-info: &rule-info
  type: http
  interval: 259200

# classical ä¸æ¨èä½¿ç”¨ å¤æ‚åº¦è¾ƒé«˜ä¸å»ºè®®æ·»åŠ å¤ªå¤š
classical: &rule-classical
  behavior: classical
  <<: *rule-info
# domain or ipcidr æ¨èä½¿ç”¨ åŒ¹é…æ›´é«˜æ•ˆ
domain: &rule-domain
  behavior: domain
  <<: *rule-info

# å¼•ç”¨è§„åˆ™é›†
rule-providers:
  Apple:
    <<: *rule-domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt
    path: ./Providers/Ruleset/Apple.yaml
  iCloud:
    <<: *rule-domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt
    path: ./Providers/Ruleset/iCloud.yaml
  Private:
    <<: *rule-domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt
    path: ./Providers/Ruleset/Private.yaml
  Proxy:
    <<: *rule-domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt
    path: ./Providers/Ruleset/Proxy.yaml
  GFWList:
    <<: *rule-domain
    url: https://cdn.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt
    path: ./Providers/Ruleset/GFWList.yaml
  BiliBili:
    <<: *rule-classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/BiliBili/BiliBili.yaml
    path: ./Providers/Ruleset/BiliBili.yaml
  GlobalMedia:
    <<: *rule-classical
    url: https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/GlobalMedia/GlobalMedia.yaml
    path: ./Providers/Ruleset/GlobalMedia.yaml
  # Ad: # anti-ADçš„å¹¿å‘Šè¿‡æ»¤ æŒ‰éœ€å¯ç”¨
  #   <<: *rule-domain
  #   url: https://anti-ad.net/clash.yaml
  #   path: ./Providers/Ruleset/anti-ad-clash.yaml

# è‡ªå®šä¹‰è§„åˆ™
rules:
  - DOMAIN-SUFFIX,speedtest.net,è‡ªå®šèŠ‚ç‚¹

  - DOMAIN-SUFFIX,syncthing.net,DIRECT

  - DOMAIN-KEYWORD,-cn,DIRECT
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,cn,DIRECT

  - DOMAIN-SUFFIX,umeng.co,REJECT # REJECT å¹¿å‘Šæ‹¦æˆª
  - DOMAIN-SUFFIX,umeng.com,REJECT
  - DOMAIN-SUFFIX,umtrack.com,REJECT
  - DOMAIN-SUFFIX,ad.xiaomi.com,REJECT
  - DOMAIN-SUFFIX,ad1.xiaomi.com,REJECT

  - GEOIP,LAN,DIRECT # LAN ä½¿ç”¨ç›´è¿
  - GEOIP,CN,DIRECT # CN ä½¿ç”¨ç›´è¿

  - DOMAIN-SUFFIX,ai.com,OpenAi # åŸŸååç¼€åŒ¹é… ä½¿ç”¨ä»£ç†ç»„
  - DOMAIN-SUFFIX,openai.com,OpenAi
  - DOMAIN-SUFFIX,identrust.com,OpenAi

  - IP-CIDR,162.159.193.0/24,DIRECT # IP æ®µåŒ¹é… Cloudflare
  - IP-CIDR,91.108.0.0/16,è‡ªåŠ¨é€‰æ‹©,no-resolve
  - IP-CIDR,109.239.140.0/24,è‡ªåŠ¨é€‰æ‹©,no-resolve

  - RULE-SET,Apple,è‹¹æœæœåŠ¡
  - RULE-SET,iCloud,è‹¹æœæœåŠ¡
  - RULE-SET,BiliBili,å“”å“©å“”å“©
  - RULE-SET,GlobalMedia,å›½å¤–åª’ä½“
  - RULE-SET,Proxy,è‡ªåŠ¨é€‰æ‹©
  - RULE-SET,Private,DIRECT

  - MATCH,æ¼ç½‘ä¹‹é±¼ # ä½¿ç”¨æ¼ç½‘ä¹‹é±¼åˆ†ç»„ å¯ä»¥ç†è§£ä¸ºé»‘åå•æ¨¡å¼
  # - MATCH, DIRECT # ä½¿ç”¨ç›´è¿ å³ç™½åå•æ¨¡å¼ é…åˆä¸‹æ–¹GFWListæ•ˆæœæ›´ä½³
  # - RULE-SET,GFWList,è‡ªåŠ¨é€‰æ‹©
